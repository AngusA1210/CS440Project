<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CS440 Project 2 Layered</title>
</head>
<body>
    <h1>Welcome to our online shopping page!</h1>
    <h2>List Your Item for Sale:</h2>
    <form id="itemForm">
        <label for="title">Item Name:</label>
        <input type="text" id="title" name="title" required><br><br>

        <label for="cost">Cost ($):</label>
        <input type="number" id="cost" name="cost" step="0.01" required><br><br>

        <label for="description">Description:</label>
        <textarea id="description" name="description" required></textarea><br><br>
        
        <button type="submit">Submit</button>
    </form>
    
    <h2>Items for Sale</h2>
    <ul id="itemList"></ul>

    <script>
        document.getElementById('itemForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            // Gets the name of the item
            const title = document.getElementById('title').value;
			
			// Gets the cost of the item
            const cost = parseFloat(document.getElementById('cost').value);
			
			// Gets the description of the item
            const description = document.getElementById('description').value;

            const response = await fetch('/api/items', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
				// Sends the item to the server
                body: JSON.stringify({ title, cost, description })
            });

            const result = await response.json();
            if (result.success) {
			    // Refresh the list of items
                loadItems();
            }
        });

        async function loadItems() {
            const response = await fetch('/api/items');
            const items = await response.json();

            const itemList = document.getElementById('itemList');
            itemList.innerHTML = '';
            items.forEach(item => {
                const li = document.createElement('li');
                li.textContent = `${item.title} - $${item.cost.toFixed(2)}: ${item.description}`;
                itemList.appendChild(li);
            });
        }

        // Loads the items once the page is loaded
        loadItems();
    </script>
</body>
</html>
